# Amazon VPC Lattice - Centralized VPC Endpoints (Terraform)

![Centralized VPC Endpoints Architecture](../../../../images/centralized.png)

## Prerequisites

- **AWS Account**: With appropriate IAM permissions
- **Terraform**: >= 1.3.0 installed
- **AWS CLI**: Configured with credentials (optional, for verification)
- **Permissions required**:
  - VPC Lattice: Service networks, resource gateways, resource configurations
  - EC2: VPC, subnets, instances, security groups, VPC endpoints
  - IAM: Create roles and policies

## Deployment

```bash
# Clone the repository
git clone https://github.com/aws-samples/amazon-vpc-lattice-blueprints.git

# Navigate to the Terraform directory
cd patterns/3-advanced_architectures/3-centralized_vpc_endpoints/terraform

# (Optional) Configure variables
# Create terraform.tfvars to customize:
# - identifier
# - aws_region
# - vpc_endpoints (list of AWS services)

# Initialize Terraform
terraform init

# (Optional) Review the planned changes
terraform plan

# Deploy the resources
terraform apply
```

> **Note**: EC2 instances and VPC endpoints will be deployed in all the Availability Zones configured for each VPC. Keep this in mind when testing this environment from a cost perspective - for production environments, we recommend the use of at least 2 AZs for high-availability.

## Cleanup

```bash
# Destroy all resources
terraform destroy
```

## Next Steps

After successfully deploying this pattern:

1. **Test connectivity**: Verify EC2 instances can access AWS services through centralized endpoints.
2. **Add more endpoints**: Modify the CloudFormation templates to include additional AWS services.
3. **Scale consumers**: Deploy additional consumer VPCs to share the centralized endpoints.
4. **Production hardening**: Add monitoring, logging, and alerting for the centralized endpoints.

